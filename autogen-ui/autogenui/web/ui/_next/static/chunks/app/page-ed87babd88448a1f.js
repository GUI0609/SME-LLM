(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{89198:function(e,s,t){Promise.resolve().then(t.bind(t,52004))},52004:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return ChatBoxView}});var n=t(57437),l=t(31706),a=t(62572),r=t(17933),o=t(51809),i=t(55856),c=t(85290),d=t(10887),u=t(33316),m=t(67896),h=t(33116),x=t(2265),g=t(98809),p=t(43241),v=t(78583),f=t(21037);function MarkdownView(e){var s;let{data:t}=e;return(0,n.jsx)("div",{className:"   w-full chatbox prose dark:prose-invert text-primary rounded p-2 ",children:(0,n.jsx)(p.U,{remarkPlugins:[g.Z],components:{code(e){let{node:s,inline:t,className:l,children:a,...r}=e,o=/language-(\w+)/.exec(l||""),i=o?o[1]:"text";return!t&&o?(0,n.jsx)(f.Z,{...r,style:v.Z,language:i,className:"rounded",PreTag:"div",wrapLongLines:!0,children:String(a).replace(/\n$/,"")}):(0,n.jsx)("code",{...r,className:l,children:a})}},children:null==(s=(s=t).replace(/\n/g,"  \n"))?void 0:s.replace(/```markdown\s+([\s\S]*?)\s+```/g,(e,s)=>s)})})}function AgentMessagesView(e){let{messages:s}=e,t=(s||[]).map((e,s)=>{let t=s%2==0?"bg-primary":"bg-secondary";return(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"text-xs border rounded p-2 mb-2 ".concat(t),children:(0,n.jsx)(MarkdownView,{data:e.content})})},"messagerow"+s)});return(0,n.jsxs)("div",{className:" overflow-x-hidden overflow-y-auto h-full scroll",children:[" ",(0,n.jsxs)("div",{className:"mb-2 text-xs",children:["The agent workflow generated ",t.length," message",t.length>1?"s":""," "]}),(0,n.jsx)("div",{children:t})]})}function ChatBoxView(e){let{initMessages:s,viewHeight:t="100%"}=e,g=x.useRef(null),p=x.useRef(null),[v,f]=x.useState(!1),[j,b]=x.useState(null),[N,w]=x.useState({status:!0,message:"All good"}),[k,y]=x.useState([]);x.useEffect(()=>{y(s)},[s]);let C=k.map((e,s)=>{var t,i,c,d,h;let x="user"===e.sender,g=!1;e.metadata&&(g=null!==e.metadata.code||(null===(c=e.metadata.images)||void 0===c?void 0:c.length)>0||(null===(d=e.metadata.files)||void 0===d?void 0:d.length)>0||(null===(h=e.metadata.scripts)||void 0===h?void 0:h.length)>0);let p=[];return x&&p.push({label:(0,n.jsx)("div",{onClick:()=>{console.log("retrying"),getCompletion(e.text)},children:(0,n.jsxs)("span",{className:"inline-block",children:[" ",(0,n.jsx)(l.Z,{role:"button",title:"Retry",className:"h-4 w-4 mr-1 inline-block"}),"Retry"]})}),key:"retrymessage"}),g&&p.push({label:(0,n.jsxs)("div",{onClick:()=>{},children:[(0,n.jsx)(a.Z,{title:"View Metadata",className:"h-4 w-4 mr-1 inline-block"}),"View Metadata"]}),key:"metadata"}),m.Z,(0,n.jsxs)("div",{className:"align-right ".concat(x?"text-right":"","  mb-2 "),children:[" ",(0,n.jsxs)("div",{className:"  ".concat(x?"":" w-full"," inline-flex gap-2"),children:[(0,n.jsxs)("div",{className:"",children:[" ",!x&&(0,n.jsxs)("span",{className:"inline-block  text-accent  bg-primary pb-2 ml-1",children:[(0,n.jsx)(r.Z,{className:"inline-block h-6 "})," "]})]}),(0,n.jsxs)("div",{className:"inline-block ".concat(x?"":" w-full "," p-2 rounded  "),children:[" ",x&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"  ".concat(x?"bg-accent text-white  ":"bg-light"," p-2 rounded"),children:[e.text,(0,n.jsx)("div",{role:"button",onClick:()=>{console.log("retrying"),getCompletion(e.text)}})]}),(0,n.jsxs)("span",{role:"button",onClick:()=>{console.log("retrying"),getCompletion(e.text)},className:"mt-1 text-sm inline-block",children:[" ",(0,n.jsx)(l.Z,{title:"Retry",className:"h-4 w-4 mr-1 inline-block"}),"Retry"]})]}),!x&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(MarkdownView,{data:e.text}),(0,n.jsx)(u.Z,{size:"small",className:"text-xs mt-2",items:[{key:"1",label:(0,n.jsxs)("div",{children:["Agent Messages (".concat(null===(t=e.metadata)||void 0===t?void 0:t.messages.length,")"),(0,n.jsxs)("span",{className:"ml-2",children:["$",null===(i=e.metadata)||void 0===i?void 0:i.usage.total_cost.toFixed(3)]})]}),children:(0,n.jsx)("div",{children:(0,n.jsx)(AgentMessagesView,{messages:e.metadata.messages})})}],onChange:e=>{console.log("changed",e)}})]})]}),x&&(0,n.jsx)(o.Z,{className:"inline-block h-6 "})]})]},"message"+s)});x.useEffect(()=>{scrollChatBox()},[k]),x.useEffect(()=>{!1===v&&g.current&&g.current&&(null===N||N&&!1===N.status)&&(g.current.value="")},[v]),x.useEffect(()=>{},[]);let chatHistory=e=>{let s="";return e.forEach(e=>{s+="".concat(e.sender,": ").concat(e.text," \n")}),s},scrollChatBox=()=>{var e;null===(e=p.current)||void 0===e||e.scroll({top:p.current.scrollHeight,behavior:"smooth"})},getLastMessage=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;for(let t=e.length-1;t>=0;t--){let n=e[t].content;if(n.length>s)return n}return null},getCompletion=e=>{w(null);let s=Object.assign([],k),t=chatHistory(k);console.log("****history****",t),s.push({text:e,sender:"user"}),y(s);let n={prompt:e,history:t};console.log("payload",n);let l={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)};f(!0),fetch("".concat("/api","/generate"),l).then(e=>{f(!1),200===e.status?e.json().then(e=>{if(e&&e.status){console.log("******* response received ",e);let t=getLastMessage(e.data.messages),n={text:t,sender:"bot",metadata:e.data};b(n),s.push(n),y(s=Object.assign([],s)),console.log(s)}else console.log("error",e),h.ZP.error(e.message)}):h.ZP.error("Connection error. Ensure server is up and running.")}).catch(e=>{f(!1),h.ZP.error("Connection error. Ensure server is up and running.")})};return(0,n.jsxs)("div",{style:{height:"calc(100% - 20px)"},className:"text-primary   overflow-auto relative scroll   rounded flex-1 ",children:[(0,n.jsxs)("div",{style:{height:"calc(100% - 100px)"},ref:p,className:"flex overflow-auto  flex-col rounded  scroll pr-2   ",children:[(0,n.jsx)("div",{className:"flex-1  boder mt-4"}),(0,n.jsxs)("div",{className:"ml-2 ",children:[" ",C]}),(0,n.jsx)("div",{className:"ml-2 h-6   mb-4 mt-2   ",children:v&&(0,n.jsxs)("div",{className:"inline-flex gap-2",children:[(0,n.jsx)("span",{className:"  rounded-full bg-accent h-2 w-2  inline-block"}),(0,n.jsx)("span",{className:"animate-bounce rounded-full bg-accent h-3 w-3  inline-block"}),(0,n.jsx)("span",{className:" rounded-full bg-accent h-2 w-2  inline-block"})]})})]}),(0,n.jsxs)("div",{className:"mt-2 p-2   w-full",children:[(0,n.jsxs)("div",{className:"mt-2   rounded p-2 shadow-lg flex mb-1    ".concat(v?" opacity-50 pointer-events-none":""),children:[(0,n.jsx)("form",{autoComplete:"on",className:"flex-1 ",onSubmit:e=>{e.preventDefault()},children:(0,n.jsx)("input",{id:"queryInput",name:"queryInput",autoComplete:"on",onKeyDown:e=>{if("Enter"===e.key&&g.current&&!v){var s;getCompletion(null===(s=g.current)||void 0===s?void 0:s.value)}},ref:g,className:"w-full text-gray-600 rounded rounded-r-none border border-accent bg-white p-2   ropunded-sm"})}),(0,n.jsxs)("div",{role:"button",onClick:()=>{if(g.current&&!v){var e;getCompletion(null===(e=g.current)||void 0===e?void 0:e.value)}},className:"bg-accent   hover:brightness-75 transition duration-300 rounded pt-2 rounded-l-none px-5 ",children:[" ",!v&&(0,n.jsxs)("div",{className:"inline-block     ",children:[(0,n.jsx)(i.Z,{className:"h-6 text-white   inline-block"})," "]}),v&&(0,n.jsx)("div",{className:"inline-block   ",children:(0,n.jsx)(c.Z,{className:"relative -pb-2 text-white animate-spin  inline-flex rounded-full h-6 w-6"})})]})]})," ",N&&!N.status&&(0,n.jsxs)("div",{className:"p-2 border rounded mt-4 text-orange-500 text-sm",children:[" ",(0,n.jsx)(d.Z,{className:"h-5 text-orange-500 inline-block mr-2"})," ",N.message]})]})]})}}},function(e){e.O(0,[900,689,971,472,744],function(){return e(e.s=89198)}),_N_E=e.O()}]);